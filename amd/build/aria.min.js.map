{"version":3,"file":"aria.min.js","sources":["../src/aria.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Enhancements to Bootstrap components for accessibility.\r\n *\r\n * @module     theme_boost/aria\r\n * @copyright  2018 Damyon Wiese <damyon@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport $ from \"jquery\";\r\nimport Pending from \"core/pending\";\r\n\r\n/**\r\n * Drop downs from bootstrap don't support keyboard accessibility by default.\r\n */\r\nconst dropdownFix = () => {\r\n  let focusEnd = false;\r\n  const setFocusEnd = (end = true) => {\r\n    focusEnd = end;\r\n  };\r\n  const getFocusEnd = () => {\r\n    const result = focusEnd;\r\n    focusEnd = false;\r\n    return result;\r\n  };\r\n\r\n  // Special handling for navigation keys when menu is open.\r\n  const shiftFocus = (element) => {\r\n    const delayedFocus = (pendingPromise) => {\r\n      element.focus();\r\n      pendingPromise.resolve();\r\n    };\r\n    setTimeout(delayedFocus, 50, new Pending(\"core/aria:delayed-focus\"));\r\n  };\r\n\r\n  // Event handling for the dropdown menu button.\r\n  const handleMenuButton = (e) => {\r\n    const trigger = e.key;\r\n    let fixFocus = false;\r\n\r\n    // Space key or Enter key opens the menu.\r\n    if (trigger === \" \" || trigger === \"Enter\") {\r\n      fixFocus = true;\r\n      // Cancel random scroll.\r\n      e.preventDefault();\r\n      // Open the menu instead.\r\n      e.target.click();\r\n    }\r\n\r\n    // Up and Down keys also open the menu.\r\n    if (trigger === \"ArrowUp\" || trigger === \"ArrowDown\") {\r\n      fixFocus = true;\r\n    }\r\n\r\n    if (!fixFocus) {\r\n      // No need to fix the focus. Return early.\r\n      return;\r\n    }\r\n\r\n    // Fix the focus on the menu items when the menu is opened.\r\n    const menu = e.target.parentElement.querySelector('[role=\"menu\"]');\r\n    let menuItems = false;\r\n    let foundMenuItem = false;\r\n\r\n    if (menu) {\r\n      menuItems = menu.querySelectorAll('[role=\"menuitem\"]');\r\n    }\r\n    if (menuItems && menuItems.length > 0) {\r\n      // Up key opens the menu at the end.\r\n      if (trigger === \"ArrowUp\") {\r\n        setFocusEnd();\r\n      } else {\r\n        setFocusEnd(false);\r\n      }\r\n\r\n      if (getFocusEnd()) {\r\n        foundMenuItem = menuItems[menuItems.length - 1];\r\n      } else {\r\n        // The first menu entry, pretty reasonable.\r\n        foundMenuItem = menuItems[0];\r\n      }\r\n    }\r\n\r\n    if (foundMenuItem) {\r\n      shiftFocus(foundMenuItem);\r\n    }\r\n  };\r\n\r\n  // Search for menu items by finding the first item that has\r\n  // text starting with the typed character (case insensitive).\r\n  document.addEventListener(\"keypress\", (e) => {\r\n    if (e.target.matches('.dropdown [role=\"menu\"] [role=\"menuitem\"]')) {\r\n      const menu = e.target.closest('[role=\"menu\"]');\r\n      if (!menu) {\r\n        return;\r\n      }\r\n      const menuItems = menu.querySelectorAll('[role=\"menuitem\"]');\r\n      if (!menuItems) {\r\n        return;\r\n      }\r\n\r\n      const trigger = e.key.toLowerCase();\r\n\r\n      for (let i = 0; i < menuItems.length; i++) {\r\n        const item = menuItems[i];\r\n        const itemText = item.text.trim().toLowerCase();\r\n        if (itemText.indexOf(trigger) == 0) {\r\n          shiftFocus(item);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  // Keyboard navigation for arrow keys, home and end keys.\r\n  document.addEventListener(\"keydown\", (e) => {\r\n    // We only want to set focus when users access the dropdown via keyboard as per\r\n    // guidelines defined in w3 aria practices 1.1 menu-button.\r\n    if (e.target.matches('[data-toggle=\"dropdown\"]')) {\r\n      handleMenuButton(e);\r\n    }\r\n\r\n    if (e.target.matches('.dropdown [role=\"menu\"] [role=\"menuitem\"]')) {\r\n      const trigger = e.key;\r\n      let next = false;\r\n      const menu = e.target.closest('[role=\"menu\"]');\r\n\r\n      if (!menu) {\r\n        return;\r\n      }\r\n      const menuItems = menu.querySelectorAll('[role=\"menuitem\"]');\r\n      if (!menuItems) {\r\n        return;\r\n      }\r\n      // Down key.\r\n      if (trigger == \"ArrowDown\") {\r\n        for (let i = 0; i < menuItems.length - 1; i++) {\r\n          if (menuItems[i] == e.target) {\r\n            next = menuItems[i + 1];\r\n            break;\r\n          }\r\n        }\r\n        if (!next) {\r\n          // Wrap to first item.\r\n          next = menuItems[0];\r\n        }\r\n      } else if (trigger == \"ArrowUp\") {\r\n        // Up key.\r\n        for (let i = 1; i < menuItems.length; i++) {\r\n          if (menuItems[i] == e.target) {\r\n            next = menuItems[i - 1];\r\n            break;\r\n          }\r\n        }\r\n        if (!next) {\r\n          // Wrap to last item.\r\n          next = menuItems[menuItems.length - 1];\r\n        }\r\n      } else if (trigger == \"Home\") {\r\n        // Home key.\r\n        next = menuItems[0];\r\n      } else if (trigger == \"End\") {\r\n        // End key.\r\n        next = menuItems[menuItems.length - 1];\r\n      }\r\n\r\n      // Variable next is set if we do want to act on the keypress.\r\n      if (next) {\r\n        e.preventDefault();\r\n        shiftFocus(next);\r\n      }\r\n      return;\r\n    }\r\n  });\r\n\r\n  $(\".dropdown\").on(\"hidden.bs.dropdown\", (e) => {\r\n    // We need to focus on the menu trigger.\r\n    const trigger = e.target.querySelector('[data-toggle=\"dropdown\"]');\r\n    const focused = document.activeElement != document.body ? document.activeElement : null;\r\n    if (trigger && focused && e.target.contains(focused)) {\r\n      shiftFocus(trigger);\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * A lot of Bootstrap's out of the box features don't work if dropdown items are not focusable.\r\n */\r\nconst comboboxFix = () => {\r\n  $(document).on(\"show.bs.dropdown\", (e) => {\r\n    if (e.relatedTarget.matches('[role=\"combobox\"]')) {\r\n      const combobox = e.relatedTarget;\r\n      const listbox = combobox.parentElement.querySelector('[role=\"listbox\"]');\r\n      const selectedOption = listbox.querySelector('[role=\"option\"][aria-selected=\"true\"]');\r\n\r\n      // To make sure ArrowDown doesn't move the active option afterwards.\r\n      setTimeout(() => {\r\n        if (selectedOption) {\r\n          selectedOption.classList.add(\"active\");\r\n          combobox.setAttribute(\"aria-activedescendant\", selectedOption.id);\r\n        } else {\r\n          const firstOption = listbox.querySelector('[role=\"option\"]');\r\n          firstOption.setAttribute(\"aria-selected\", \"true\");\r\n          firstOption.classList.add(\"active\");\r\n          combobox.setAttribute(\"aria-activedescendant\", firstOption.id);\r\n        }\r\n      }, 0);\r\n    }\r\n  });\r\n\r\n  $(document).on(\"hidden.bs.dropdown\", (e) => {\r\n    if (e.relatedTarget.matches('[role=\"combobox\"]')) {\r\n      const combobox = e.relatedTarget;\r\n      const listbox = combobox.parentElement.querySelector('[role=\"listbox\"]');\r\n\r\n      combobox.removeAttribute(\"aria-activedescendant\");\r\n\r\n      setTimeout(() => {\r\n        // Undo all previously highlighted options.\r\n        listbox.querySelectorAll('.active[role=\"option\"]').forEach((option) => {\r\n          option.classList.remove(\"active\");\r\n        });\r\n      }, 0);\r\n    }\r\n  });\r\n\r\n  // Handling keyboard events for both navigating through and selecting options.\r\n  document.addEventListener(\"keydown\", (e) => {\r\n    if (e.target.matches('.select-menu [role=\"combobox\"]')) {\r\n      const combobox = e.target;\r\n      const trigger = e.key;\r\n      let next = null;\r\n      const options = combobox.parentElement.querySelectorAll('[role=\"listbox\"] [role=\"option\"]');\r\n      const activeOption = combobox.parentElement.querySelector('[role=\"listbox\"] .active[role=\"option\"]');\r\n\r\n      // Under the special case that the dropdown menu is being shown as a result of they key press (like when the user\r\n      // presses ArrowDown or Enter or ... to open the dropdown menu), activeOption is not set yet.\r\n      // It's because of a race condition with show.bs.dropdown event handler.\r\n      if (options && activeOption) {\r\n        if (trigger == \"ArrowDown\") {\r\n          for (let i = 0; i < options.length - 1; i++) {\r\n            if (options[i] == activeOption) {\r\n              next = options[i + 1];\r\n              break;\r\n            }\r\n          }\r\n        }\r\n        if (trigger == \"ArrowUp\") {\r\n          for (let i = 1; i < options.length; i++) {\r\n            if (options[i] == activeOption) {\r\n              next = options[i - 1];\r\n              break;\r\n            }\r\n          }\r\n        } else if (trigger == \"Home\") {\r\n          next = options[0];\r\n        } else if (trigger == \"End\") {\r\n          next = options[options.length - 1];\r\n        } else if (trigger == \" \" || trigger == \"Enter\") {\r\n          selectOption(combobox, activeOption);\r\n        } else {\r\n          // Search for options by finding the first option that has\r\n          // text starting with the typed character (case insensitive).\r\n          for (let i = 0; i < options.length; i++) {\r\n            const option = options[i];\r\n            const optionText = option.textContent.trim().toLowerCase();\r\n            const keyPressed = e.key.toLowerCase();\r\n            if (optionText.indexOf(keyPressed) == 0) {\r\n              next = option;\r\n              break;\r\n            }\r\n          }\r\n        }\r\n\r\n        // Variable next is set if we do want to act on the keypress.\r\n        if (next) {\r\n          e.preventDefault();\r\n          activeOption.classList.remove(\"active\");\r\n          next.classList.add(\"active\");\r\n          combobox.setAttribute(\"aria-activedescendant\", next.id);\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  document.addEventListener(\"click\", (e) => {\r\n    if (e.target.matches('.select-menu [role=\"option\"]')) {\r\n      const option = e.target;\r\n      const combobox = option.closest(\".select-menu\").querySelector('[role=\"combobox\"]');\r\n      combobox.focus();\r\n      selectOption(combobox, option);\r\n    }\r\n  });\r\n\r\n  // In case some code somewhere else changes the value of the combobox.\r\n  document.addEventListener(\"change\", (e) => {\r\n    if (e.target.matches('.select-menu input[type=\"hidden\"]')) {\r\n      const combobox = e.target.parentElement.querySelector('[role=\"combobox\"]');\r\n      const option = e.target.parentElement.querySelector(`[role=\"option\"][data-value=\"${e.target.value}\"]`);\r\n\r\n      if (combobox && option) {\r\n        selectOption(combobox, option);\r\n      }\r\n    }\r\n  });\r\n\r\n  const selectOption = (combobox, option) => {\r\n    const oldSelectedOption = combobox.parentElement.querySelector(\r\n      '[role=\"listbox\"] [role=\"option\"][aria-selected=\"true\"]'\r\n    );\r\n    const inputElement = combobox.parentElement.querySelector('input[type=\"hidden\"]');\r\n\r\n    if (oldSelectedOption != option) {\r\n      if (oldSelectedOption) {\r\n        oldSelectedOption.removeAttribute(\"aria-selected\");\r\n      }\r\n      option.setAttribute(\"aria-selected\", \"true\");\r\n    }\r\n    combobox.textContent = option.textContent;\r\n    if (inputElement.value != option.dataset.value) {\r\n      inputElement.value = option.dataset.value;\r\n      inputElement.dispatchEvent(new Event(\"change\", { bubbles: true }));\r\n    }\r\n  };\r\n};\r\n\r\n/**\r\n * After page load, focus on any element with special autofocus attribute.\r\n */\r\nconst autoFocus = () => {\r\n  window.addEventListener(\"load\", () => {\r\n    const alerts = document.querySelectorAll('[data-aria-autofocus=\"true\"][role=\"alert\"]');\r\n    Array.prototype.forEach.call(alerts, (autofocusElement) => {\r\n      // According to the specification an role=\"alert\" region is only read out on change to the content\r\n      // of that region.\r\n      autofocusElement.innerHTML += \" \";\r\n      autofocusElement.removeAttribute(\"data-aria-autofocus\");\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n * Changes the focus to the correct tab based on the key that is pressed.\r\n * @param {KeyboardEvent} e\r\n */\r\nconst updateTabFocus = (e) => {\r\n  const tabList = e.target.closest('[role=\"tablist\"]');\r\n  const vertical = tabList.getAttribute(\"aria-orientation\") == \"vertical\";\r\n  const rtl = window.right_to_left();\r\n  const arrowNext = vertical ? \"ArrowDown\" : rtl ? \"ArrowLeft\" : \"ArrowRight\";\r\n  const arrowPrevious = vertical ? \"ArrowUp\" : rtl ? \"ArrowRight\" : \"ArrowLeft\";\r\n  // eslint-disable-next-line max-len\r\n  const tabs = Array.prototype.filter.call(tabList.querySelectorAll('[role=\"tab\"]'), (tab) => !!tab.offsetHeight); // We only work with the visible tabs.\r\n\r\n  for (let i = 0; i < tabs.length; i++) {\r\n    tabs[i].index = i;\r\n  }\r\n\r\n  switch (e.key) {\r\n    case arrowNext:\r\n      e.preventDefault();\r\n      if (e.target.index !== undefined && tabs[e.target.index + 1]) {\r\n        tabs[e.target.index + 1].focus();\r\n      } else {\r\n        tabs[0].focus();\r\n      }\r\n      break;\r\n    case arrowPrevious:\r\n      e.preventDefault();\r\n      if (e.target.index !== undefined && tabs[e.target.index - 1]) {\r\n        tabs[e.target.index - 1].focus();\r\n      } else {\r\n        tabs[tabs.length - 1].focus();\r\n      }\r\n      break;\r\n    case \"Home\":\r\n      e.preventDefault();\r\n      tabs[0].focus();\r\n      break;\r\n    case \"End\":\r\n      e.preventDefault();\r\n      tabs[tabs.length - 1].focus();\r\n  }\r\n};\r\n\r\n/**\r\n * Fix accessibility issues regarding tab elements focus and their tab order in Bootstrap navs.\r\n */\r\nconst tabElementFix = () => {\r\n  document.addEventListener(\"keydown\", (e) => {\r\n    if ([\"ArrowUp\", \"ArrowDown\", \"ArrowLeft\", \"ArrowRight\", \"Home\", \"End\"].includes(e.key)) {\r\n      if (e.target.matches('[role=\"tablist\"] [role=\"tab\"]')) {\r\n        updateTabFocus(e);\r\n      }\r\n    }\r\n  });\r\n\r\n  document.addEventListener(\"click\", (e) => {\r\n    if (e.target.matches('[role=\"tablist\"] [data-toggle=\"tab\"], [role=\"tablist\"] [data-toggle=\"pill\"]')) {\r\n      const tabs = e.target.closest('[role=\"tablist\"]').querySelectorAll('[data-toggle=\"tab\"], [data-toggle=\"pill\"]');\r\n      e.preventDefault();\r\n      $(e.target).tab(\"show\");\r\n      tabs.forEach((tab) => {\r\n        tab.tabIndex = -1;\r\n      });\r\n      e.target.tabIndex = 0;\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Fix keyboard interaction with Bootstrap Collapse elements.\r\n *\r\n * @see {@link https://www.w3.org/TR/wai-aria-practices-1.1/#disclosure|WAI-ARIA Authoring Practices 1.1 - Disclosure (Show/Hide)}\r\n */\r\nconst collapseFix = () => {\r\n  document.addEventListener(\"keydown\", (e) => {\r\n    if (e.target.matches('[data-toggle=\"collapse\"]')) {\r\n      // Pressing space should toggle expand/collapse.\r\n      if (e.key === \" \") {\r\n        e.preventDefault();\r\n        e.target.click();\r\n      }\r\n    }\r\n  });\r\n};\r\n\r\nexport const init = () => {\r\n  dropdownFix();\r\n  comboboxFix();\r\n  autoFocus();\r\n  tabElementFix();\r\n  collapseFix();\r\n};\r\n"],"names":["dropdownFix","focusEnd","setFocusEnd","end","shiftFocus","element","setTimeout","pendingPromise","focus","resolve","Pending","handleMenuButton","e","trigger","key","fixFocus","preventDefault","target","click","menu","parentElement","querySelector","menuItems","foundMenuItem","querySelectorAll","length","result","getFocusEnd","document","addEventListener","matches","closest","toLowerCase","i","item","text","trim","indexOf","next","on","focused","activeElement","body","contains","tabElementFix","includes","tabList","vertical","getAttribute","rtl","window","right_to_left","arrowNext","arrowPrevious","tabs","Array","prototype","filter","call","tab","offsetHeight","index","undefined","updateTabFocus","forEach","tabIndex","relatedTarget","combobox","listbox","selectedOption","classList","add","setAttribute","id","firstOption","removeAttribute","option","remove","options","activeOption","selectOption","optionText","textContent","keyPressed","value","oldSelectedOption","inputElement","dataset","dispatchEvent","Event","bubbles","comboboxFix","alerts","autofocusElement","innerHTML"],"mappings":"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"}